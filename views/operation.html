<link rel='stylesheet' type='text/css' href='/js2/calculator/jquery.calculator.css' />
<link rel='stylesheet' type='text/css' href='/css2/jquery/south-street/ui.datepicker.css' />
<script type='text/javascript' src='/js2/jquery/ui.core.js'></script>
<script type="text/javascript" src="/js2/jquery/jquery.calculator.min.js"></script>
<script type="text/javascript" src="/js2/jquery/jquery.calculator-ru.js"></script>
<script type="text/javascript" src="/js2/jquery/ui.datepicker.js"></script>
<script type="text/javascript" src="/js2/operation.js?r={$revision}"></script>
<h3>Операции по счету</h3>
<table width="100%">
    <tr>
        <td width="100%" colspan="4" class=cat_add valign="top">
            <!-- Переписать, на вывод нормального селекта из массива -->
            <select name="account" id="account">
                {foreach from=$accounts item=acc_data}
                <option id="{$acc_data.id}" value="{$acc_data.id}" {if $acc_data.id eq $sess.user.current_curr} selected {/if}>{$acc_data.name}</option>
                {/foreach}
            </select>

            &nbsp;
            <input type="button" id="btn_AddOperation" value="Добавить операцию" />
            &nbsp;
            <input type="button" id="btn_EditAccount" value="Редактировать счет / Удалить счет" />

            <br><br>

            <div id="addOperation" style="display:none;">
                <p>{$POS_msg}</p>
                <div id="POS_SUM" style="display:none"></div>
                <table width="100%" border="0" style=" background-color:#f8f8d8; padding-top:15px; padding-bottom:15px; border:1px dotted #ff6002;">
                    <tr>
                        <td  align="right" class="cat_add" width="10%">Тип операции: </td>
                        <td  align="left" class="cat_add" width="90%">
                            <select name="type" id="type">
                                <option value="0">Расход</option>
                                <option value="1">Доход</option>
                                <option value="2">Перевод со счета</option>
                                <!--<option value="3">Покупка валюты</option>-->
                                <option value="4">Перевод на финансовую цель</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td  align="right" class="cat_add" valign="top">
			Сумма:
                        </td>
                        <td  align="left" class="cat_add">
                            <input type="text" id="amount">&nbsp;<b>Пример:</b> 125.50
                        </td>
                    </tr>
                    <tr id='old_cat'>
                        <td align="right" class="cat_add">Категория:</td>
                        <td align="left" class="cat_add">
                        {if !empty($list)}
                            <select name="cat_id" style="width:250px;" id="cat_id_old">
                                {if !empty($often)}
                                <optgroup id="often" label="&nbsp;Часто используемые">
                	{foreach from=$often item=data}
                                    <option value="{$data.cat_id}">{$data.cat_name}</option>
                                    {/foreach}
                                </optgroup>
                                {/if}

                                <optgroup id="all" label="&nbsp;Все категории">
            	{foreach from=$list item=data}
                	{if $data.cat_parent == 0}
                                    <option value="{$data.cat_id}">{$data.cat_name}</option>
                                    {foreach from=$list item=child}
                        	{if $child.cat_parent == $data.cat_id}
                                    <option value="{$child.cat_id}">&nbsp;&nbsp;&nbsp;&nbsp;- {$child.cat_name}</option>
                                    {/if}
                                    {/foreach}
                                    {/if}
                                    {/foreach}
                                </optgroup>

                            </select>
                            {else}
                            <select name="cat_id" style="width:250px;" id="cat_id_old">
				{$categories}
                            </select>
                            {/if}
						{if !empty($restore_cat)}
							(<a href="index.php?modules=money&action=edit&id={$money.id}&restore={$restore_cat}">
							Восстановить категорию:&nbsp;{$money.cat_restore}</a>)
						{/if}
                            <span style="padding-left:10px;"><a href='index.php?modules=category' class="cat_add">Нет нужной категории? Добавьте ее в разделе [категории]</a></span>
                        </td>
                    </tr>
                    <tr id="target_fields">
                        <td align="right" class="cat_add">Финансовая цель:</td>
                        <td align="left" class="cat_add"><select name="target_sel" id="target_sel" onChange="changeTarget()">
			{foreach from=$targetList item=target}
                                <option bill="{$target.target_account_id}" value="{$target.id}"
                                        target_account_id='{$target.target_account_id}' amount_done='{$target.amount_done}'
                                        percent_done='{$target.percent_done}' forecast_done='{$target.forecast_done}' amount={$target.amount}
                                        {if $target.id==$target_sel}selected{/if}>
                                        {$target.title|stripslashes|truncate:50:".."}</option>
                                {/foreach}
                            </select></td>
                    </tr>
                    <tr id="transferSelect" style="display:none; ">
                        <td align="right" class="cat_add">На счет:</td>
                        <td align="left" class="cat_add">
                            <select name="selectAccountForTransfer" id="selectAccountForTransfer" onChange="changeAccountForTransfer();">
				{foreach from=$accounts item=acc_data}
                                <option id="{$acc_data.id}" value="{$acc_data.id}">{$acc_data.name}</option>
				{/foreach}
                            </select>
                            <span id="operationTransferCurrency" style="padding-left:5px;"></span>
                        </td>
                    </tr>
                    <tr>
                        <td  align="right" class="cat_add">
			Дата:
                        </td>
                        <td  align="left" class="cat_add">
                            <input type="text" value="{$dateTo}" class="standart" style="width:80px;" name="money[date]" id="sel3"><button type="reset" class="button_calendar" onclick="return showCalendar('sel3', '%d.%m.%Y', false, true);"><img src="img/calendar/cal.gif"></button>
                        </td>
                    </tr>
                    <tr id='target_fields_info'>
                        <td align='right' class='cat_add'>&nbsp;</td>
                        <td align='left' style='font-size:11px;'>
                            <table>
                                <tr><td class='cat_add'>Стоимость цели: <span id='amount'/><span class='currency'/></td></tr>
                                <tr><td class='cat_add'>Сумма накопленная: <span id='amount_done' /><span class='currency' /></td></tr>
                                <tr><td class='cat_add'>Прогноз: <span id='forecast_done'></span> %</td></tr>
                                <tr><td class='cat_add'>Процент готовности: <span id='percent_done'></span> %</td></tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td  align="right" class="cat_add" valign="top">Комментарий:</td>
                        <td  align="left" class="cat_add">
                            <textarea rows="4" cols="50" name="comment" id="comment"></textarea>
                        </td>
                    </tr>
                    {if $ass}
                    <tr>
                        <td>&nbsp;</td>
                        <td class="cat_add" valign="top">
                            <input style="margin-left:-1px;display:block; float:left;" type="checkbox" name="e_pos-box" id="e_pos-box" value="" checked="checked">
                            <label style="font-size:120%;cursor:pointer" for="e_pos-box">провести электронно</label>
                        </td>
                    </tr>
                    {/if}
                    <tr>
                        <td  align=right class=cat_add valign=top>Состояние:</td>
                        <td  align=left class=cat_add>
                            <input type="checkbox" id="close" name="close" value="Закрытая финансовая цель" />
                            <label for="close">Закрытая финансовая цель</label>
                        </td>
                    </tr>
                    <tr>
                        <td  align="right" class="cat_add" valign="top">&nbsp;</td>
                        <td  align="left" class="cat_add">
                            <input class="inputsubmit" type="button" value="Сохранить" onclick="addOperation();">
                            <input class="inputsubmit" type="button" value="Отменить" onclick="operationAddInVisible();">
                        </td>
                    </tr>
                </table>
                <br><br>
            </div>

            <!-- Странный участок -- НАЧАЛО -->
            {if $areaAdd}
            <script language="javascript">
                {literal}
                operationAddVisible();
                {/literal}
            </script>
            {/if}

            {if $areaTransfer}
            <script language="javascript">
                {literal}
                operationAddVisible();
                document.getElementById("type_add").value = 2;
                changeTypeOperation('add');
                {/literal}
            </script>
            {/if}
            <!-- Странный участок -- ОКОНЧАНИЕ -->

            <div id="editOperation" style="display:none;"><br><br></div>
            <div>
		с: <input type="text" value="{$dateFrom}" name="dateFrom" id="dateFrom">&nbsp;
		по: <input type="text" value="{$dateTo}" name="dateTo" id="dateTo">&nbsp;&nbsp;
		категория:
                <select name="categories" id="categories">
                    <option label="Все" value=""> --- Все ---</option>
                    {$categories}
                </select>
                &nbsp;&nbsp;
                <input type="button" value="Обновить данные" id="btn_ReloadData"/>
            </div>

            <br>
            {if $begin == "00.00.0000"}
            Начальный капитал:
            {if $account.drain == 0}<font color="green">{$account.money}&nbsp;{$account.cur_name}</font>
            {else}<font color="#bc5f5f">{$account.money}&nbsp;{$account.cur_name}</font>{/if}
            {/if}
            <span style="color: #76b900; font-size:14px;" id="goodOperation"></span>
            <span style="color: #bc5f5f; font-size:14px;" id="badOperation"></span>

        </td>
    </tr>
    <tr>
        <td valign="top" width="100%" style=" background-color:#f8f8d8; padding:5px;">
            <div id="operationDataList"></div>
        </td>
    </tr>
</table>